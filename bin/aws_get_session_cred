#!/bin/sh

(
    aws sts get-session-token | 
        egrep 'Key|Session' | 
        sed -e 's/^ *"//' -e 's/": *"/="/' -e 's/,$//' \
            -e 's/SecretAccessKey/export AWS_SECRET_ACCESS_KEY/' \
            -e 's/SessionToken/export AWS_SESSION_TOKEN/' \
            -e 's/AccessKeyId/export AWS_ACCESS_KEY_ID/'
) > /tmp/${USER}_token

ifdh cp /tmp/${USER}_token  /pnfs/nova/scratch/users/${USER}/awst
ifdh chmod 600 /pnfs/nova/scratch/users/${USER}/awst
