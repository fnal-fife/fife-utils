#!/usr/bin/env python

from fife_sam_utils import dataset
import sys
import os

def pin( ds , just_say = False):
    thirtydays = 30 * 24 * 60 * 60
    for p in ds.fullpath_iterator():
        if p.startswith('/pnfs'):
            if just_say:
                print "I would ifdh pin ", p, " for ", thirtydays
            else:
                ds.ifdh_handle.pin( p, thirtydays )

def usage(argv):
    print argv[0], ": usage: "
    print argv[0], "dataset_name1  dataset_name2 ..."
    print "	-- pin files for 30 days in dcache"

if __name__ == '__main__':
    
    cmd = sys.argv[0]
    just_say = False

    while len(sys.argv) > 1 and sys.argv[1][0] == "-":
      if sys.argv[1] == '-h':
        usage(sys.argv)
        exit(0)

      if sys.argv[1] == '-n':
        just_say = True
        sys.argv = sys.argv[1:]
        sys.argv[0] = cmd
        continue

      print "unknown option %s" % sys.argv[1]
      usage(sys.argv)
      exit(1)

    if len(sys.argv) == 1:
        usage(sys.argv)
        exit(1)

    for ds in sys.argv[1:]:
       pin(dataset(ds), just_say)

